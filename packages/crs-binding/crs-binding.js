var g=Object.getPrototypeOf(async function(){}).constructor;function me(r,e,t){e=e||[];let s=!0,n=!1,i="context";if(t!=null&&(t.sanitize!=null&&(s=t.sanitize),t.async!=null&&(n=t.async),t.ctxName!=null&&(i=t.ctxName)),crsbinding._expFn.has(r)){let h=crsbinding._expFn.get(r);return h.count+=1,h}let l=r,a;if(s==!0){if(a=crsbinding.expression.sanitize(r,i),crsbinding._expFn.has(a.expression)){let p=crsbinding._expFn.get(a.expression);return p.count+=1,p}l=a.isLiteral===!0?["return `",a.expression,"`"].join(""):`return ${a.expression}`,a.expression.split(".").length>2&&(l=`try { ${l} } catch(error) { return null }`)}else a={expression:r};let c={function:n==!0?new g(i,...e,l):new Function(i,...e,l),parameters:a,count:1};return crsbinding._expFn.set(a.expression,c),c}function ge(r){if(r==null||typeof r!="object")return;let e=r.parameters.expression;if(crsbinding._expFn.has(e)){let t=crsbinding._expFn.get(e);t.count-=1,t.count==0&&(crsbinding.utils.disposeProperties(t),crsbinding._expFn.delete(e))}}var d=Object.freeze({WORD:"word",LITERAL:"literal",FUNCTION:"function",PROPERTY:"property",OBJECT:"object",KEYWORD:"keyword",OPERATOR:"operator",NUMBER:"number",SPACE:"space",STRING:"string"});function ve(r,e){let t=[],s=[],n=0;function i(a,o){if(s.length>0){let c=s.join("");l(c)}t.push({type:a,value:o})}function l(a){let o=d.WORD;be.indexOf(a)!=-1&&(o=d.KEYWORD),isNaN(Number(a))==!1&&(o=d.NUMBER),t.push({type:o,value:a}),s.length=0}for(n;n<r.length;n++){let a=r[n];if(a==" "){i(d.SPACE," ");continue}if(a=="`"){i(d.LITERAL,"`");continue}if(a=="$"&&r[n+1]=="{"){i(d.KEYWORD,"${"),n++;continue}if(a=="'"||a=='"'){let o=n+r.length-n,c=!1;if(r[n+1]==null){i(d.STRING,a);break}let h=n+1;for(h;h<o;h++){if(r[h]=="$"&&r[h+1]=="{"){c=!0;break}if(r[h]==a){let p=r.substring(n,h+1);i(d.STRING,p);break}}c==!0?i(d.STRING,a):n=h;continue}if(be.indexOf(a)!=-1){i(d.KEYWORD,a);continue}if(xe.indexOf(a)!=-1){for(let o=n;o<n+4;o++){let c=r[o];if(xe.indexOf(c)==-1){let h=r.substring(n,o);i(d.OPERATOR,h),n=o-1;break}}continue}s.push(a)}return s.length>0&&l(s.join("")),nt(t,e)}function nt(r,e){if(r.length==1&&r[0].type==d.WORD)return r[0].type=d.PROPERTY,r;let t=[],s=!1,n=0;for(;r[n]!=null;){let i=r[n],l=t.length==0?"none":t[t.length-1],a=i.value.indexOf(".");if(i.type==d.WORD)if(l==d.LITERAL){if(i.value[0]=="."&&r[n+1].value=="("){i.type=d.FUNCTION,n++;continue}i.type=d.PROPERTY}else a!=-1?r[n-1]?.value===")"&&a===0?i.type=d.FUNCTION:i.type=d.PROPERTY:$(r[n+1])||$(r[n+2])?e!==!0&&l!==d.OBJECT&&(i.type=d.PROPERTY):e!==!0&&$(r[n-1])||$(r[n-2])?l!==d.OBJECT&&(i.type=d.PROPERTY):n===0&&r[n+1]?.value==="("&&(i.type=d.PROPERTY);if(i.type==d.KEYWORD&&i.value=="("&&r[n-1]&&r[n-1].type==d.PROPERTY&&r[n-1].value[0]!="$"){let o=r[n-1].value;if(o.indexOf(".")==-1)r[n-1].type=d.FUNCTION;else{let c=o.length-1;for(let h=o.length-1;h>=0;h--)if(o[h]=="."){c=h;break}if(c>0){let h=o.substring(0,c),p=o.substring(c,o.length);r[n-1].value=h,r.splice(n,0,{type:d.FUNCTION,value:p}),n++}else r[n-1].type=d.FUNCTION}}i.value=="${"?t.push(d.LITERAL):i.value=="{"?t.push(d.OBJECT):i.value=="}"&&t.pop(),n++}return r[0].type===d.FUNCTION&&(r[0].type=d.PROPERTY),r}function $(r){return r==null?!1:r.type==d.OPERATOR}var xe=["=","!","<",">","+","-","*","/","&","|","?",":"],be=["{","}","(",")",",","true","false","null","undefined","[]"];var it=["false","true","null"];function ye(r,e="context",t=!1){let s=!1;if(typeof r=="string"&&r.indexOf("$html")!=-1&&(s=!0,r=r.split("$html.").join("")),r==null||r=="null"||r=="undefined"||it.indexOf(r.toString())!=-1||isNaN(r)==!1||r.trim()==e)return{isLiteral:!0,expression:r,isHTML:s};if(e!="context"==!0&&r==["${",e,"}"].join(""))return{isLiteral:!0,expression:r};let i=new Set,l=r.indexOf("${")!=-1,a=ve(r,l),o=[];for(let c of a)c.type=="property"?(c.value.indexOf("$globals")!=-1?o.push(c.value.replace("$globals","crsbinding.data.globals")):c.value.indexOf("$event")!=-1?o.push(c.value.replace("$event","event")):c.value.indexOf("$context")!=-1?o.push(c.value.replace("$context","context")):c.value.indexOf("$data")!=-1?o.push(c.value.replace("$data","crsbinding.data.getValue")):c.value.indexOf("$parent")!=-1?o.push(c.value.replace("$parent","parent")):e!=="context"&&c.value.indexOf(`${e}.`)!=-1?o.push(c.value):o.push(`${e}.${c.value}`),at(i,c.value,e)):o.push(c.value);return{isLiteral:l,isHTML:s,expression:o.join(""),properties:Array.from(i)}}var rt=[".trim",".toLowerCase","toUpperCase"],lt=["$data","$event"];function at(r,e,t){if(e.length==0)return;for(let i of lt)if(e.indexOf(i)!=-1)return;let s=e,n=`${t}.`;s.indexOf(n)==0&&(s=s.replace(n,""));for(let i of rt)s.indexOf(i)!=-1&&(s=s.split(i).join(""));r.add(s)}var u=class{get data(){return crsbinding.data.getValue(this._context)}constructor(e,t,s,n,i,l,a=!0){this._cleanEvents=[],this._element=e,this._context=t,this._property=s,this._value=n,this._ctxName=i||"context",this._eventsToRemove=[],this._isNamedContext=this._ctxName!="context",this._parentId=l,this._value&&this._value.indexOf("$parent")!=-1&&a==!0&&(this._value=this._value.split("$parent.").join(""),this._context=l),this._value&&this._value.indexOf("$self")!=-1&&(this._value=this._value.split("$self.").join(""),this._context=this._element._dataId),this.init&&this.init(),crsbinding.providerManager.register(this),this.initialize().catch(o=>{throw o}),this._element.nodeName.indexOf("-")!=-1&&this._property==this._ctxName&&(this._element[this._property]=this._context)}dispose(){this._eventsToRemove.length=0,this._eventsToRemove=null,this._element=null,this._context=null,this._property=null,this._value=null,this._ctxName=null,crsbinding.events.removeOnPath(this._cleanEvents),this._cleanEvents=null}async initialize(){}listenOnPath(e,t){let s=Array.isArray(e)==!0?e:[e];for(let n of s){let i=crsbinding.events.listenOnPath(this._context,n,t);this._cleanEvents=[...this._cleanEvents,...i]}}};var Oe="requestAnimationFrame(() => element.__property__ = value);",Ce='requestAnimationFrame(() => element.__property__ = value == null ? "" : value);';var Ee="requestAnimationFrame(() => element.__property__ = (__exp__) ? __true__ : __false__)",Pe='element.dataset["__property__"] = value == null ? "" : value',we=`
if (element.__classList!=null) {
    const remove = Array.isArray(element.__classList) ? element.__classList : [element.__classList];
    remove.forEach(cls => element.classList.remove(cls));
}`,ae=`
element.__classList = value;
const add = Array.isArray(value) ? value : [value];
add.forEach(cls => element.classList.add(cls));`,Ae=`${we} ${ae}`,$e=`
    ${we}

    if (__exp__) {
        ${ae.split("value").join("__true__")}
    }
    else {
        ${ae.split("value").join("__false__")}
    }
`;function je(r){let e=[];for(let t of r.children)e.push(t.outerHTML);return e.join("")}function Te(r){return r.content!=null?r.content.cloneNode(!0):r.children[0].cloneNode(!0)}function Ie(r){return new Promise(e=>{let t=r,s;r.nodeName==="#document-fragment"?(t=document.createElement("div"),t.appendChild(r),t.style.width="max-content",t.style.height="max-content",t.style.position="fixed",t.style.transform="translate(-100px, -100px)",document.body.appendChild(t),s=t.getBoundingClientRect(),document.body.removeChild(t)):s=t.getBoundingClientRect(),e(s)})}var ot=["_element"];function oe(r){if(r==null||Object.isFrozen(r))return;let e=Object.getOwnPropertyNames(r).filter(t=>ot.indexOf(t)==-1);for(let t of e){let s=r[t];if(typeof s=="object"){if(s==null||s.autoDispose==!1)continue;Array.isArray(s)!=!0&&oe(s)}delete r[t]}}function j(r,e,t){r[e]=t,r.__cleanup=r.__cleanup||[],r.__cleanup.push(e)}function ce(r){if(r==null||r[r.length-1]=="/")return r;let e=r.split("/");return e.pop(),`${e.join("/")}/`}function Se(r,e){let t=ce(r),s=["","."],n=e.split("./"),i=t.split("/");i.pop();let l=0;for(let c=0;c<n.length;c++){let h=n[c];if(s.indexOf(h)===-1)break;h=="."&&i.pop(),l+=1}n.splice(0,l);let a=n.join("/");return`${i.join("/")}/${a}`}function b(r){let e=r.split("of"),t=e[0].trim(),s=e[1].trim();return{singular:t,plural:s}}function E(r,e,t){if(typeof e=="string")r[0]==="."&&(r=r.substring(1)),t[r]=e;else{let s=Object.keys(e);for(let n of s)E(`${r}.${n}`,e[n],t)}}function T(r){let e;if(r._property.toLocaleLowerCase()=="classlist")return Ae;if(r._property.indexOf("data-")!=-1){let t=r._property.replace("data-","");return Pe.split("__property__").join(t)}return e=r._property=="value"||r._property=="placeholder"?Ce:Oe,r._property=crsbinding.utils.capitalizePropertyPath(r._property),e.split("__property__").join(r._property)}function ke(r,e,t){if(r!=null&&e!=null){let s=()=>{r.removeEventListener("ready",s);let n=crsbinding.data.getValue(t);j(r,e,n)};r.isReady==!0?s():r.addEventListener("ready",s)}}var v=class extends u{dispose(){let e=`${this._ctxName}.`;this._value.indexOf(e)==0&&(this._value=this._value.replace(e,"")),this._expObj!=null&&(crsbinding.expression.release(this._expObj),delete this._expObj),this._exp=null,this._eventHandler=null,super.dispose()}async initialize(){if(this._value=="$context"||this._value==this._ctxName)return ke(this._element,this._property,this._context);this._eventHandler=this.propertyChanged.bind(this),this._exp=T(this),this._expObj=crsbinding.expression.compile(this._exp,["element","value"],{sanitize:!1,ctxName:this._ctxName});let e=this._value;this._isNamedContext==!0&&(e=this._value.split(`${this._ctxName}.`).join("")),this.listenOnPath(e,this._eventHandler);let t=crsbinding.data.getValue(this._context,e);t!=null&&this.propertyChanged(e,t)}propertyChanged(e,t){this._expObj!=null&&(this._isLinked!=!0&&this._element._dataId!=null&&(crsbinding.data.link(this._context,e,this._element._dataId,this._property,t),this._isLinked=!0),crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element,t)))}};var ct=["INPUT","SELECT","TEXTAREA"],P=class extends v{dispose(){this._element.removeEventListener(this._eventName,this._changeHandler),this._eventName=null,this._changeHandler=null,super.dispose()}async initialize(){await super.initialize(),this._changeHandler=this._change.bind(this),this._eventName=ct.indexOf(this._element.nodeName)!==-1?"change":`${this._property}Change`,this._element.addEventListener(this._eventName,this._changeHandler),this._value.indexOf("$globals.")!==-1&&(this._context=crsbinding.$globals,this._value=this._value.split("$globals.").join(""))}_change(e){let t=e.target[this._property],s=e.target.type||"text",n=`_${s}`;this[n]!=null&&(t=this[n](t,e.target));let i=crsbinding.data.getValue(this._context,this._value);crsbinding.data._setContextProperty(this._context,this._value,t,{oldValue:i,ctxName:this._ctxName,dataType:s=="text"?"string":s}),e.stopPropagation()}_number(e){return Number(e)}_date(e){return new Date(e)}_checkbox(e,t){return t.checked==!0}};var I=class extends u{dispose(){this._expObj!=null&&(crsbinding.expression.release(this._expObj),delete this._expObj),this._exp=null,this._getValueFn=null,this._eventHandler=null,super.dispose()}async initialize(){this._eventHandler=this.propertyChanged.bind(this),this._exp=T(this),this._expObj=crsbinding.expression.compile(this._exp,["element","value"],{sanitize:!1,ctxName:this._ctxName});let e=crsbinding.expression.sanitize(this._value,this._ctxName);this._getValueFn=new Function(this._ctxName,`return ${e.expression}`);for(let t of e.properties)this.listenOnPath(t,this._eventHandler);this.propertyChanged()}propertyChanged(){let e=this._getValueFn(this.data);crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element,e))}};function Ne(r,e,t,s,n="context",i){return n=="context"?ht(r,e,t,s,i):dt(r,e,t,s,n,i),null}function ht(r,e,t,s){Le(r,t,crsbinding.data.getValue(e,s))}function dt(r,e,t,s,n){n!="context"&&(s=s.split(`${n}.`).join(""));let i=crsbinding.data.getValue(e,s);Le(r,t,i)}function Le(r,e,t){if(e.indexOf("data-")==-1)e=crsbinding.utils.capitalizePropertyPath(e),j(r,e,t);else{let s=e.replace("data-","");r.dataset[s]=t}}var f=class extends u{constructor(e,t,s,n,i,l){super(e,t,s,n,i,l),this._eventHandler=this.event.bind(this),this._element.addEventListener(this._property,this._eventHandler)}dispose(){this._element.removeEventListener(this._property,this._eventHandler),this._eventHandler=null,this._fn=null,super.dispose()}async initialize(){let e=`context.${this._value}`.split("$event").join("event");e.indexOf(")")==-1&&(e=`${e}.call(context, event)`),this._fn=new Function("context","event",e)}event(e){let t=crsbinding.data.getContext(this._context);crsbinding.idleTaskManager.add(this._fn(t,e))}};var S=class extends u{constructor(e,t,s,n,i,l){super(e,t,s,n,i,l);let a=e.textContent;a.indexOf("$parent.")!=-1&&(e.textContent=a.split("$parent.").join(""),this._context=l),this._value=a,this._eventHandler=this._change.bind(this),this._expObj=crsbinding.expression.compile(this._value,null,{ctxName:this._ctxName});for(let o of this._expObj.parameters.properties)this.listenOnPath(o,this._eventHandler);this._change()}dispose(){crsbinding.expression.release(this._expObj),this._expObj=null,super.dispose(),this._eventHandler=null}_change(){if(this._expObj==null)return;let e=this._expObj.function(this.data);e=e==null?"":e.split("undefined").join("");let t="textContent";this._expObj.parameters.isHTML==!0&&(t="innerHTML"),this._element[t]=e}};var y=class extends u{constructor(e,t,s,n,i,l){super(e,t,s,n,i,l),this._eventHandler=this._change.bind(this),this._expObj=crsbinding.expression.compile(this._value,null,{ctxName:this._ctxName});for(let a of this._expObj.parameters.properties)this.listenOnPath(a,this._eventHandler);this._change()}dispose(){crsbinding.expression.release(this._expObj),this._expObj=null,super.dispose(),this._eventHandler=null}_change(){let e=this._expObj.function(this.data);e==null?this._element.removeAttribute(this._property):this._element.setAttribute(this._property,e)}};var m=class extends u{dispose(){this._singular=null,this._plural=null,this._container=null,this._collectionChangedHandler=null,this.positionStruct.addAction=null,this.positionStruct.removeAction=null,this.positionStruct=null,super.dispose()}async initialize(){this._container=this._element.parentElement,this._shouldClearAll=this._container.children.length==1,this._determineInsertParameters();let e=this._value.split("of");this._singular=e[0].trim(),this._plural=e[1].trim(),this._collectionChangedHandler=this._collectionChanged.bind(this),this.listenOnPath(this._plural,this._collectionChangedHandler)}async _collectionChanged(e,t){if(t==null)return this._clear();await this._renderItems(t)}_determineInsertParameters(){let e=this._element.nextElementSibling,t=this._element.previousElementSibling;this.positionStruct={startIndex:Array.from(this._container.children).indexOf(this._element),addAction:e!=null?this._insertBefore.bind(e):this._appendItems.bind(this._element),removeAction:()=>this._removeBetween.call(this._element,t,e)}}_appendItems(e){this.parentElement.appendChild(e)}_insertBefore(e){this.parentElement.insertBefore(e,this)}_removeBetween(e,t){let s=Array.from(this.parentElement.children),n=s.indexOf(e),i=s.indexOf(t);n==-1&&(n=0),i==-1&&(i=s.length);let l=[];for(let a=n+1;a<i;a++)s[a].nodeName.toLowerCase()!="template"&&l.push(s[a]);for(let a of l)a.parentElement.removeChild(a)}_clear(){this._shouldClearAll==!0?this._clearAll():this._clearPartial()}_clearAll(){let e=Array.from(this._container.children).filter(t=>t.nodeName.toLowerCase()!="template");for(let t of e)t.parentElement.removeChild(t),crsbinding.observation.releaseBinding(t)}_clearPartial(){this.positionStruct.removeAction()}async _renderItems(){this._clear()}async createElement(e,t){let s=this._element.dataset.reference||"array-item",n=crsbinding.data.createReferenceTo(this._context,`${this._context}-${s}-${t}`,this._plural,t),i=crsbinding.utils.cloneTemplate(this._element);await crsbinding.parsers.parseElement(i,n,{ctxName:this._singular,parentId:this._context}),e.__uid=n;for(let l of i.children)l.dataset.uid=n;return i}updateAttributeProviders(e){for(let t of e.__providers||[]){let s=crsbinding.providerManager.items.get(t);s instanceof y&&s._change()}}};var k=class extends m{init(){this._itemsAddedHandler=this._itemsAdded.bind(this),this._itemsDeletedHandler=this._itemsDeleted.bind(this)}dispose(){this._itemsAddedHandler=null,this._itemsDeletedHandler=null,super.dispose()}async initialize(){super.initialize(),crsbinding.data.setArrayEvents(this._context,this._plural,this._itemsAddedHandler,this._itemsDeletedHandler)}async _renderItems(e){await super._renderItems();let t=document.createDocumentFragment();for(let s of e){s.__aId=crsbinding.data.nextArrayId();let n=await this.createElement(s,s.__aId);t.appendChild(n)}this.positionStruct.addAction(t),this._container.__providers==null&&(this._container.__providers=[]),this._container.__providers.indexOf(this.id)==-1&&this._container.__providers.push(this.id),this._container.dispatchEvent(new CustomEvent("rendered"))}_itemsAdded(e,t){for(let s=0;s<e.length;s++){let n=e[s],i=t.indexOf(n);n.__aId=crsbinding.data.nextArrayId(),this.createElement(n,n.__aId).then(l=>{let a=l.children[0],o=this._container.children[i+this.positionStruct.startIndex+1];this._container.insertBefore(l,o),this.updateAttributeProviders(a)})}}_itemsDeleted(e,t){if(e==null)return;let s=[],n=Array.isArray(e)?e:[e];for(let i of n){let l=i.__uid;this._container.querySelectorAll([`[data-uid="${l}"]`]).forEach(o=>s.push(o)),crsbinding.data.removeObject(l)}for(let i of s)i!=null&&(i.parentElement.removeChild(i),crsbinding.observation.releaseBinding(i))}};var N=class extends u{constructor(e,t,s,n,i,l){super(e,t,s,n,i,l,!1)}dispose(){crsbinding.expression.release(this._expObj),delete this._expObj.parentObj,delete this._expObj,this._eventHandler=null,super.dispose()}async initialize(){this._sanitizeProperties=["fill","stroke"],this._eventHandler=this.propertyChanged.bind(this);let e;this._value.indexOf("?")==-1?e=this._initCndAttr():this._value.indexOf(":")!=-1?e=this._initCndValue():e=this._initCndAttrValue(),this._value.indexOf("$parent")!=-1&&(this._expObj.parentObj=crsbinding.data.getValue(this._parentId),e.properties.forEach(t=>{if(t.indexOf("$parent.")!=-1){let s=t.replace("$parent.",""),n=crsbinding.events.listenOnPath(this._parentId,s,this._eventHandler);this._cleanEvents=[...this._cleanEvents,n]}})),this.propertyChanged()}_initCndAttr(){let e=crsbinding.expression.sanitize(this._value,this._ctxName),t=He.split("__exp__").join(e.expression).split("__attr__").join(this._property).split("__attr-value__").join(this._property);return this._expObj=crsbinding.expression.compile(t,["element","parent"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(e.properties.filter(s=>s.indexOf("$parent")==-1),this._eventHandler),e}_initCndValue(){let e=crsbinding.expression.sanitize(this._value,this._ctxName),t=e.expression.split("?"),s=t[1].split(":"),n=this._sanitizeValue(s[0].trim()),i=this._sanitizeValue(s[1].trim()),l=ut.split("__exp__").join(t[0].trim()).split("__attr__").join(this._property).split("__true__").join(n).split("__false__").join(i);return this._expObj=crsbinding.expression.compile(l,["element","parent"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(e.properties,this._eventHandler),e}_initCndAttrValue(){let e=crsbinding.expression.sanitize(this._value,this._ctxName),t=e.expression.split("?"),s=He.split("__exp__").join(t[0].trim()).split("__attr__").join(this._property).split("__attr-value__").join(t[1].trim());return this._expObj=crsbinding.expression.compile(s,["element","parent"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(e.properties,this._eventHandler),this.propertyChanged(),e}_sanitizeValue(e){return this._sanitizeProperties.indexOf(this._property)==-1?e:e.split("'").join("")}propertyChanged(){try{crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element,this._expObj.parentObj))}catch{return}}},He=`
if (__exp__) {
    element.setAttribute("__attr__", "__attr-value__");
}
else {
    element.removeAttribute("__attr__");
}
`,ut=`
if (__exp__) {
    element.setAttribute("__attr__", __true__);
}
else {
    element.setAttribute("__attr__", __false__);
}
`;var L=class extends u{constructor(e,t,s,n,i,l){super(e,t,s,n,i,l)}dispose(){crsbinding.expression.release(this._expObj),delete this._expObj,this._eventHandler=null,super.dispose()}async initialize(){this._eventHandler=this.propertyChanged.bind(this);let e=this._value.split("?"),t=crsbinding.expression.sanitize(e[0],this._ctxName),s=t.expression,n=e[1].split(":"),i=n[0].trim(),l=n.length>1?n[1].trim():"[]",a=$e.split("__property__").join(this._property).split("__exp__").join(s).split("__true__").join(i).split("__false__").join(l);this._expObj=crsbinding.expression.compile(a,["element"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(t.properties,this._eventHandler),this.propertyChanged()}propertyChanged(){try{crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element))}catch{return}}};var H=class extends u{constructor(e,t,s,n,i,l){super(e,t,s,n,i,l)}dispose(){crsbinding.expression.release(this._expObj),delete this._expObj,this._eventHandler=null,super.dispose()}async initialize(){this._eventHandler=this.propertyChanged.bind(this);let e=crsbinding.expression.sanitize(this._value,this._ctxName),t=e.expression.split("?"),s=t[0].trim(),n=t[1].split(":"),i=n[0].trim(),l=n.length>1?n[1].trim():'""',a=Ee.split("__property__").join(crsbinding.utils.capitalizePropertyPath(this._property)).split("__exp__").join(s).split("__true__").join(i).split("__false__").join(l);this._expObj=crsbinding.expression.compile(a,["element"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(e.properties,this._eventHandler),this.propertyChanged()}propertyChanged(){try{crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element))}catch{return}}};var O=class extends f{async initialize(){let e=this._value.split("("),t=e[0],s=["{"];e.length>0&&this._getParametersCode(e[1],s),s.push("}");let n=this._getSource(t,s.join(""));this._fn=new Function("context",n)}_getSource(e,t){return`crsbinding.events.emitter.emit("${e}", ${t});`}_getParametersCode(e,t){if(e==null)return;let s=e.split(")").join("").split(",");for(let n=0;n<s.length;n++){let l=s[n].trim();this[l]!=null?this[l](t):this._processArg(l,t),n<s.length-1&&t.push(",")}}$event(e){e.push("event: event")}$context(e){e.push("context: context")}_processArg(e,t){let s=e.split("="),n=s[0].trim(),i=this._processValue(s[1]);t.push(`${n}:${i}`)}_processValue(e){return e.indexOf("${")!=-1?e.split("${").join("context.").split("}").join(""):e}};var M=class extends O{async initialize(){let e=this._value.indexOf("["),t=this._value.indexOf("]"),s=this._value.substring(e+1,t).split(" ").join("").split(","),i=[`{key: "${this._value.substring(0,e).trim()}",`],l=this._value.indexOf("("),a=this._value.indexOf(")");if(l!=-1){let c=this._value.substring(l+1,a);this._getParametersCode(c,i)}i.push("}");let o=this._getSource(s,i.join(""));this._fn=new Function("context",o)}_getSource(e,t){let s=[];for(let n of e)n=n.split("'").join("").split('"').join(""),s.push(`crsbinding.events.emitter.postMessage("${n}", ${t});`);return s.join(`
`)}};var F=class extends f{async initialize(){let e=this._createSource();this._fn=new Function("context","event","setProperty",e)}_createSource(){if(this._value.trim()[0]!="[")return this._createSourceFrom(this._value);let e=[],s=this._value.substr(1,this._value.length-2).split(";");for(let n of s)e.push(this._createSourceFrom(n.trim()));return e.join(`
`)}_createSourceFrom(e){let t=e.split("="),s=this._processRightPart(t[1].trim());return this._processLeftPart(t[0].trim(),s)}_processRightPart(e){return crsbinding.expression.sanitize(e,this._ctxName,!0).expression}_processLeftPart(e,t){return e.indexOf("$globals")!=-1?this._getGlobalSetter(e,t):this._getContextSetter(e,t)}_getGlobalSetter(e,t){return`crsbinding.data.setProperty({_dataId: crsbinding.$globals}, "${e.replace("$globals.","")}", ${t});`}_getContextSetter(e,t){if(e=e.replace("$context.",""),t.indexOf("context.")!=-1){let s=t.split("context."),n=s[s.length-1];t=`${s[0]=="!"?"!":""}crsbinding.data.getValue({_dataId: ${this._context}}, "${n}")`}return`crsbinding.data.setProperty({_dataId: ${this._context}}, "${e}", ${t});`}event(e){let t=crsbinding.data.getContext(this._context);crsbinding.idleTaskManager.add(this._fn(t,e,this._setProperty)),e.stopPropagation()}_setProperty(e,t,s){s!==void 0&&crsbinding.data.setProperty(this,t,s)}};var z=class extends u{constructor(e,t,s,n,i,l){super(e,t,s,n,i,l),this._eventHandler=this.event.bind(this),this._element.addEventListener(this._property,this._eventHandler)}dispose(){this._element.removeEventListener(this._property,this._eventHandler),this._eventHandler=null,super.dispose()}event(){if(globalThis.crs?.process==null)return console.error("crs-process-api not present or running at this time");this._value[0]=="{"?pt(this):this._value.split("{")[0].indexOf("[")==-1?_t(this):ft(this)}};function pt(r){let e=de(r._value,r._context),t=he(e,r._context),s=crsbinding.data.getContext(r._context);crs.process.runStep(t,s,null,null)}function _t(r){let t=de(r._value,r._context).split("("),s=t[0].split("."),n=`{type: "${s[0]}", action: "${s[1]}", args: ${t[1]}}`.replace(")",""),i=he(n,r._context),l=crsbinding.data.getContext(r._context);crs.process.runStep(i,l,null,null)}function ft(r){let t=de(r._value,r._context).split("["),s=t[0],n=t[1].replace("]","").split("("),i=n[0],l=mt(n[1].replace(")","").trim(),r._context),o={context:crsbinding.data.getContext(r._context),step:{action:i,args:{schema:s}}};l!=null&&(o.parameters=l),crsbinding.events.emitter.emit("run-process",o)}function he(r,e){r.indexOf("{")==-1&&(r=`{${r}}`);let t=new Function("context",`return ${r};`),s=crsbinding.data.getContext(e),n=crsbinding.data.getData(e).data,i={};Object.assign(i,n),Object.assign(i,s);let l=t(i);return i=null,l}function mt(r,e){return r.length==0?null:he(r,e)}function de(r,e){return r.replace("bId",`bId: ${e}`).split("$context.").join("context.")}var V=class extends u{constructor(e,t,s,n,i,l){super(e,t,s,n,i,l,!1)}dispose(){this.clear(),this._element.removeEventListener("change",this._changeHandler),this._changeHandler=null,this._eventHandler=null,this._perspectiveElement!=null&&(this._perspectiveElement.removeEventListener("view-loaded",this.viewLoadedHandler),this.viewLoadedHandler=null,this._perspectiveElement=null),super.dispose()}async initialize(){this._changeHandler=this._change.bind(this),this._element.addEventListener("change",this._changeHandler),this._eventHandler=this.propertyChanged.bind(this),this._perspectiveElement=this._element.querySelector("perspective-element"),this._perspectiveElement!=null&&(this.viewLoadedHandler=this.viewLoaded.bind(this),this._perspectiveElement.addEventListener("view-loaded",this.viewLoadedHandler)),await this._initFields(this._perspectiveElement||this._element)}async viewLoaded(){this.clear(),await this._initFields(this._perspectiveElement)}_change(e){let t=e.target.dataset.field;if(t==null)return;let s=e.target.type||"text",n=crsbinding.data.getValue(this._context,t);crsbinding.data._setContextProperty(this._context,t,e.target.value,{oldValue:n,ctxName:this._ctxName,dataType:s=="text"?"string":s}),e.stopPropagation()}async _initFields(e){this.inputs=this.inputs||{};let t=e.querySelectorAll("[data-field]");for(let s of t)this.inputs[s.dataset.field]=s,this.listenOnPath(s.dataset.field,this._eventHandler),await crsbinding.data.updateUI(this._context,s.dataset.field)}propertyChanged(e,t){let s=this.inputs[e];s!=null&&s.value!=t&&(s.value=t??"")}clear(){let e=Object.keys(this.inputs);for(let t of e)this.removeCallback(t),this.inputs[t]=null;this.inputs=null}removeCallback(e){crsbinding.data.removeCallback(this._context,e,this._eventHandler),delete this.inputs[e];let t=this._cleanEvents.filter(s=>s.path==e);if(t!=null){let s=this._cleanEvents.indexOf(t);delete t.callback,this._cleanEvents.splice(s,1)}}};var gt=`
if (__expr__) {
    return element.classList.add(__value__);
}
`,xt="return element.classList.add(__value__);",R=class extends u{async initialize(){this._eventHandler=this.propertyChanged.bind(this),this._properties=[],bt.call(this),this.listenOnPath(this._properties,this._eventHandler),this.propertyChanged()}dispose(){this.properties=null,this.fn=null,this._eventHandler=null,super.dispose()}propertyChanged(){try{crsbinding.idleTaskManager.add(this.fn(this.data,this._element))}catch{return}}};function bt(){let r=this._value.split(","),e=[],t=[];for(let i of r){let l=i.split(":"),a=this._property,o=l[1].trim();if(t.push(o),l[0].trim()=="default"){e.push(xt.replace("__attr__",a).replace("__value__",o));continue}let c=crsbinding.expression.sanitize(l[0].trim(),this._ctxName);this._properties=[...this._properties,...c.properties],e.push(gt.replace("__expr__",c.expression).replace("__attr__",a).replace("__value__",o))}let s=new Set(this._properties);this._properties=Array.from(s);let n=`element.classList.remove(${t.join(",")});${e.join("")}`;this.fn=new g("context","element",n)}var vt=`
if (__expr__) {
    return element.__property__ = __value__;
}
`,Me="return element.__property__ = __value__;",B=class extends u{async initialize(){this._eventHandler=this.propertyChanged.bind(this),this._properties=[],yt.call(this),this.listenOnPath(this._properties,this._eventHandler),this.propertyChanged()}dispose(){this.properties=null,this.fn=null,this._eventHandler=null,super.dispose()}propertyChanged(){try{crsbinding.idleTaskManager.add(this.fn(this.data,this._element))}catch{return}}};function yt(){let r=this._value.split(","),e=[],t=!1;for(let n of r){let i=n.split(":"),l=i[1].trim();if(i[0].trim()=="default"){t=!0,e.push(Me.replace("__property__",this._property).replace("__value__",l));continue}let a=crsbinding.expression.sanitize(i[0].trim(),this._ctxName);this._properties=[...this._properties,...a.properties],e.push(vt.replace("__expr__",a.expression).replace("__property__",this._property).replace("__value__",l))}t==!1&&e.push(Me.replace("__property__",this._property).replace("__value__","'inherit'"));let s=new Set(this._properties);this._properties=Array.from(s),this.fn=new g("context","element",e.join(""))}var Ot=`
if (__expr__) {
    return element.setAttribute("__attr__", __value__);
}
`,Ct='return element.setAttribute("__attr__", __value__);',D=class extends u{async initialize(){this._eventHandler=this.propertyChanged.bind(this),this._properties=[],Et.call(this),this.listenOnPath(this._properties,this._eventHandler),this.propertyChanged()}dispose(){this.properties=null,this.fn=null,this._eventHandler=null,super.dispose()}propertyChanged(){try{crsbinding.idleTaskManager.add(this.fn(this.data,this._element))}catch{return}}};function Et(){let r=this._value.split(","),e=[],t=!1;for(let n of r){let i=n.split(":"),l=this._property,a=i[1].trim();if(i[0].trim()=="default"){t=!0,e.push(Ct.replace("__attr__",l).replace("__value__",a));continue}let o=crsbinding.expression.sanitize(i[0].trim(),this._ctxName);this._properties=[...this._properties,...o.properties],e.push(Ot.replace("__expr__",o.expression).replace("__attr__",l).replace("__value__",a))}t==!1&&e.push(`element.removeAttribute("${this._property}");`);let s=new Set(this._properties);this._properties=Array.from(s),this.fn=new g("context","element",e.join(""))}var C=class{static bind(e,t,s,n,i,l,a){return["value","checked"].indexOf(s)!=-1?new P(e,t,s,n,i,a):this["one-way"](e,t,s,n,i,a)}static dataset(e,t,s,n,i,l,a){return new V(e,t,s,n,i,a)}static"two-way"(e,t,s,n,i,l,a){return new P(e,t,s,n,i,a)}static"one-way"(e,t,s,n,i,l,a){return n[0]=="`"?new I(e,t,s,n,i,a):new v(e,t,s,n,i,a)}static once(e,t,s,n,i,l,a){return Ne(e,t,s,n,i,a)}static call(e,t,s,n,i,l,a){return new f(e,t,s,n,i,a)}static delegate(e,t,s,n,i,l,a){return new f(e,t,s,n,i,a)}static emit(e,t,s,n,i,l,a){return new O(e,t,s,n,i,a)}static post(e,t,s,n,i,l,a){return new M(e,t,s,n,i,a)}static setvalue(e,t,s,n,i,l,a){return new F(e,t,s,n,i,a)}static inner(e,t,s,n,i,l,a){return new S(e,t,s,n,i,a)}static for(e,t,s,n,i,l,a){let o=l.name.split("."),c=o.length>1?crsbinding.providerManager.providers.for[o[1]]:null;return c!=null?new c(e,t,s,n,i,a):new k(e,t,s,n,i,a)}static if(e,t,s,n,i,l,a){return s.toLowerCase()=="classlist"?new L(e,t,s,n,i,a):s.toLowerCase().indexOf("style.")!=-1?new H(e,t,s,n,i,a):new N(e,t,s,n,i,a)}static attr(e,t,s,n,i,l,a){return new y(e,t,s,n,i,a)}static process(e,t,s,n,i,l,a){return new z(e,t,s,n,i,a)}static case(e,t,s,n,i,l,a){return s.toLowerCase()=="classlist"?new R(e,t,s,n,i,l,a):s.toLowerCase().indexOf("style.")!=-1?new B(e,t,s,n,i,l,a):new D(e,t,s,n,i,l,a)}};var Pt=["style","script"];async function q(r,e,t){for(let s of r||[])await crsbinding.parsers.parseElement(s,e,t)}async function Fe(r,e,t){let s="context",n=null,i=null;if(t!=null&&(s=t.ctxName||"context",n=t.parentId||null,i=t.folder||null),r.__inflated==!0)return;let l=r.nodeName.toLowerCase();if(Pt.indexOf(l)!=-1)return;if(r.dataset?.dataset!=null&&C.dataset(r,e,null,null,s,null,n),l!="template"&&l!="perspective-element"&&r.children?.length>0&&await q(r.children,e,t),l=="template"&&r.getAttribute("src")!=null)return await $t(r,e,t);let o=Array.from(r.attributes||[]).filter(c=>c.ownerElement.tagName.toLowerCase()=="template"&&c.name=="for"||c.name=="ref"||c.name.indexOf(".")!=-1||(c.value||"").indexOf("${")==0||(c.value||"").indexOf("&{")==0);if(await wt(o,e,s,n),r.children&&r.children.length==0){let c=r.textContent||"";c.indexOf("&{")!=-1?r.textContent=await crsbinding.translations.get_with_markup(r.textContent):c.indexOf("${")!=-1&&C.inner(r,e,null,null,s,null,n)}else l==="svg"&&crsbinding.svgCustomElements.parse(r)}async function wt(r,e,t,s){for(let n of r)n.nodeValue.indexOf("&{")!==-1?n.nodeValue=await crsbinding.translations.get_with_markup(n.nodeValue):await At(n,e,t,s)}async function At(r,e,t,s){if(r.name=="ref"){crsbinding.data._context[e][r.value]=r.ownerElement;return}let n=r.name.split("."),i=n.length==2?n[0]:n.slice(0,n.length-1).join("."),l=i=="for"?i:n[n.length-1];i.length==0&&r.value[0]=="$"&&(i=l,l="attr");let a=C[l](r.ownerElement,e,i,r.value,t,r,s);return(a==null||a.constructor.name!="AttrProvider"||r.nodeName.indexOf(".attr")!=-1)&&r.ownerElement.removeAttribute(r.nodeName),a}async function $t(r,e,t){if(t?.folder==null)return;let s=crsbinding.utils.relativePathFrom(t.folder,r.getAttribute("src")),n=document.createElement("template");n.innerHTML=await fetch(s).then(a=>a.text());let i=n.content.cloneNode(!0);await q(i.children,e,t);let l=r.parentElement;l.insertBefore(i,r),l.removeChild(r)}function ue(r){crsbinding.providerManager.releaseElement(r)}function ze(r){for(let e of r.children)ue(e)}function Ve(r,e,t,s,n="context",i){s.indexOf("$parent.")!=-1&&(s=s.split("$parent.").join(""),e=i);let l=b(s),a=l.singular,o=l.plural,c=`for-once-${a}`;crsbinding.inflationManager.register(c,r,a);let h=crsbinding.data.getValue(e,o),p=crsbinding.inflationManager.get(c,h);crsbinding.inflationManager.unregister(c),r.parentElement.appendChild(p),r.parentElement.removeChild(r)}var U=class extends m{dispose(){super.dispose()}async _renderItems(e){await super._renderItems();let t=document.createDocumentFragment(),s=e.keys();for(let n of s){let i=e.get(n);i.__aId=n,t.appendChild(await this.createElement(i,n))}this.positionStruct.addAction(t),this._container.__providers==null&&(this._container.__providers=[]),this._container.__providers.indexOf(this.id)==-1&&this._container.__providers.push(this.id)}};var K=class extends u{dispose(){for(let e of this.inputs)e.removeEventListener("change",this._changeHandler);this.inputs=null,this._changeHandler=null,this._propertyToSet=null,super.dispose()}async initialize(){this._propertyToSet=this._element.getAttribute("property"),this._changeHandler=this._change.bind(this);let e=this._value.split("of"),t=e[0].trim(),s=e[1].trim(),n=`for-group-${t}`;crsbinding.inflationManager.register(n,this._element,t);let i=crsbinding.data.getValue(this._context,s),l=crsbinding.inflationManager.get(n,i);crsbinding.inflationManager.unregister(n);let a=crsbinding.data.getProperty(this._context,this._propertyToSet);this.inputs=l.querySelectorAll("input");for(let o of this.inputs)o.setAttribute("type","radio"),o.setAttribute("name",s),o.addEventListener("change",this._changeHandler),a&&o.getAttribute("value")==a.toString()&&o.setAttribute("checked","checked");this._element.parentElement.appendChild(l),this._element.parentElement.removeChild(this._element)}async _change(e){crsbinding.data.setProperty(this._context,this._propertyToSet,e.target.value)}};var W=class extends u{dispose(){crsbinding.inflationManager.unregister(this.key),this._collectionChangedHandler=null,this._parentElement=null,this.singular=null,this.plural=null,this.key=null,super.dispose()}async initialize(){this._parentElement=this._element.parentElement,this.clear();let e=b(this._value);if(this.singular=e.singular,this.plural=e.plural,this.key=this._element.dataset.id,this.key==null){console.error("for.inflate must have a data-id attribute");return}crsbinding.inflationManager.register(this.key,this._element,this.singular),this._collectionChangedHandler=this._collectionChanged.bind(this),this.listenOnPath(this.plural,this._collectionChangedHandler)}async _collectionChanged(e,t){if(t==null)return this._clear();let s=crsbinding.inflationManager.get(this.key,t,this._parentElement.children);s?.childElementCount>0&&this._parentElement.appendChild(s);let n=this._parentElement.querySelectorAll("[remove='true']");for(let i of n)this._parentElement.removeChild(i)}clear(){this._parentElement.innerHTML=""}};var Y=class{constructor(){this._nextId=0,this.items=new Map,this.providers={for:{map:U,once:Ve,radio:K,inflate:W}}}async register(e){e.id=this._nextId,e._element.__providers==null&&Reflect.set(e._element,"__providers",[]),e._element.__providers.push(this._nextId),this.items.set(this._nextId,e),this._nextId+=1}async releaseElement(e){e.nodeName.toLowerCase()=="svg"&&crsbinding.svgCustomElements.release(e);for(let t of e.__cleanup||[])e[t]=null;for(let t of e.children||[])await this.releaseElement(t);if(e.__providers!=null){for(let t of e.__providers){let s=this.items.get(t);this.items.delete(t),s&&s.dispose(),s=null}delete e.__providers,this.items.size==0&&(this._nextId=0)}}};globalThis.requestIdleCallback=globalThis.requestIdleCallback||function(r){let e=Date.now();return setTimeout(function(){r({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})},1)};globalThis.cancelIdleCallback=globalThis.cancelIdleCallback||function(r){clearTimeout(r)};var G=class{constructor(){this.processing=!1,this._list=[]}dispose(){this._list=null}async add(e){if(typeof e=="function"){if(requestIdleCallback==null)return await e();this._list.push(e),this.processing!=!0&&await this._processQueue()}}async _processQueue(){this.processing=!0;try{requestIdleCallback(async()=>{for(;this._list.length>0;){let e=this._list.shift();try{await e()}catch(t){console.error(t)}}},{timeout:1e3})}finally{this.processing=!1}}};function Re(r,e,t){typeof r=="object"&&(r=r.__uid||r._dataId);let s=Array.isArray(e)==!0?e:[e],n=[];for(let i of s)i.indexOf("$globals.")!=-1&&(r=crsbinding.$globals,i=i.replace("$globals.",""),De(n,crsbinding.$globals,i,t)),jt(r,i,t,n);return n}function Be(r){for(let e of r)crsbinding.data.removeCallback(e.context,e.path,e.callback),delete e.context,delete e.path,delete e.callback;r.length=0}function jt(r,e,t,s){crsbinding.data.addCallback(r,e,t),De(s,r,e.split("$parent.").join("").split("$context.").join(""),t)}function De(r,e,t,s){r.push({context:e,path:t,callback:s})}function qe(r){r._domEvents=[],r.registerEvent=Tt,r.unregisterEvent=It}function Ue(r){if(r._domEvents!=null){for(let e of r._domEvents)r.removeEventListener(e.event,e.callback),delete e.element,delete e.callback,delete e.event;r._domEvents.length=0,delete r._domEvents,delete r.registerEvent,delete r.unregisterEvent}}function Tt(r,e,t,s=null){r.addEventListener(e,t,s),this._domEvents.push({element:r,event:e,callback:t})}function It(r,e,t){let s=this._domEvents.find(n=>n.element==r&&n.event==e&&n.callback==t);s!=null&&(r.removeEventListener(s.event,s.callback),this._domEvents.splice(this._domEvents.indexOf(s),1),delete s.element,delete s.callback,delete s.event)}var J=class{constructor(){this._items=new Map}dispose(){this._items.clear(),this._items=null}async register(e,t,s="context",n=!1){t=t.cloneNode(!0);let i=new pe(s,e),l=await i.generateCodeFor(t),a=i.templateKeys;i.dispose(),crsbinding.elementStoreManager.register(e,t,n),this._items.set(e,{id:e,childCount:l.childCount,inflate:l.inflate,deflate:l.deflate,templates:a})}unregister(e){let t=this._items.get(e);t!=null&&(t.inflate=null,t.defaulte=null,t.templates!=null&&t.templates.forEach(s=>this.unregister(s)),this._items.delete(e)),crsbinding.elementStoreManager.unregister(e)}get(e,t,s,n){t==null&&console.error("inflation manager - get, data may not be null");let i=this._items.get(e);if(i==null)return null;if(s!=null)return this._getWithElements(i,t,s,n||0);let l=Array.isArray(t)?t.length*i.childCount:1,a=crsbinding.elementStoreManager.getElements(e,l);return this._inflateElements(i,a,t),a}_getWithElements(e,t,s,n){if(t.length==0)return null;let i=s.length-t.length*e.childCount,l=null;if(i<0){let c=-1*i;l=crsbinding.elementStoreManager.getElements(e.id,c);let h=c/e.childCount,p=t.length-h,le=t.slice(p,t.length);this._inflateElements(e,l,le),t=t.slice(0,p)}let a=0,o=[];for(let c of t){o.length=0;let h=n*e.childCount+a*e.childCount;for(let p=0;p<e.childCount;p++)o.push(s[h+p]);e.inflate(o.length>1?o:o[0],c),a+=1}if(n==0&&i>0){o=Array.from(s);for(let c=i;c>0;c--){let h=o.pop();h.parentElement.removeChild(h)}}return l}_inflateSingleElement(e,t,s){this.inflate(e.id,e.childCount==1?t.children[0]:Array.from(t.children),s,e.inflate)}_inflateSingleChildFragment(e,t,s){let n=Array.isArray(t);s=Array.isArray(s)?s:[s];for(let i=0;i<s.length;i++){let l=n?t[i]:t.children[i];this.inflate(e.id,l,s[i],e.inflate),l.__inflated=!0;let a=Array.from(l.attributes).filter(o=>o.name.indexOf(".attr")!=-1);for(let o of a)l.removeAttribute(o.name)}}_inflateMultiChildFragment(e,t,s){let n=Array.from(t.children),i=0;for(let l=0;l<s.length;l++){let a=n.slice(i,i+e.childCount);this.inflate(e.id,a,s[l],e.inflate,!1),i+=e.childCount}n.forEach(l=>{l.__inflated=!0;let a=Array.from(l.attributes).filter(o=>o.name.indexOf(".attr")!=-1);for(let o of a)l.removeAttribute(o.name)}),n.filter(l=>l.getAttribute("remove")=="true").forEach(l=>l.parentNode.removeChild(l))}_inflateElements(e,t,s){Array.isArray(s)==!1?this._inflateSingleElement(e,t,s):e.childCount==1?this._inflateSingleChildFragment(e,t,s):this._inflateMultiChildFragment(e,t,s)}inflate(e,t,s,n=null,i=!0){(n||this._items.get(e).inflate)(t,s),i==!0&&this._removeElements(t)}_removeElements(e){let t=[];Array.isArray(e)?e.forEach(s=>{let n=s.querySelectorAll('[remove="true"]');n.length>0&&(t=[...t,...n])}):t=e.querySelectorAll('[remove="true"]');for(let s of t)s.parentElement.removeChild(s)}deflate(e,t){let s=this._items.get(e).deflate;if(Array.isArray(t))for(let n of t)s(n);else s(t)}returnElements(e,t,s=!1){crsbinding.elementStoreManager.returnElements(e,t,s)}},pe=class{constructor(e,t){this.parentKey=t,this.templateKeys=[],this.inflateSrc=[],this.deflateSrc=[],this._ctxName=e}dispose(){this.inflateSrc=null,this.deflateSrc=null}async generateCodeFor(e){let t=e.content==null?e.children:e.content.children,s=t.length;if(s==1){this.path="element";for(let l of t)await this._processElement(l)}else for(let l=0;l<t.length;l++)this.path=`element[${l}]`,await this._processElement(t[l]);let n=this.inflateSrc.join(`
`),i=this.deflateSrc.join(`
`);return{childCount:s,inflate:new Function("element",this._ctxName,n),deflate:new Function("element",this._ctxName,i)}}async _processElement(e){this._clearAttributes(e),await this._processTextContent(e),await this._processAttributes(e);let t=this.path;for(let s=0;s<e.children.length;s++){let n=e.children[s];n.nodeName=="TEMPLATE"?this._processTemplate(n):(this.path=`${t}.children[${s}]`,await this._processElement(e.children[s]))}}_processTemplate(e){let t=`${this.parentKey}_${this.templateKeys.length+1}`;this.templateKeys.push(t),e.dataset.key=t;let s=e.getAttribute("for.once");if(s!=null){let n=b(s),i=`${this.path}.appendChild(crsbinding.inflationManager.get("${t}", ${n.plural}));`;this.inflateSrc.push(i),crsbinding.inflationManager.register(t,e,n.singular),e.parentElement.removeChild(e)}}async _processTextContent(e){if(e.children==null||e.children.length>0||e.textContent.indexOf("${")==-1&&e.textContent.indexOf("&{")==-1)return;let t=(e.innerHTML||"").trim(),s="textContent",n=t;if(n.indexOf("&amp;{")!=-1){let i=n.replace("&amp;{","").replace("}",""),l=await crsbinding.translations.get(i);l==null?this.inflateSrc.push(`crsbinding.translations.get("${i}").then(result => ${this.path}.textContent = result);`):this.inflateSrc.push(`${this.path}.textContent = "${l}"`)}else{let i=crsbinding.expression.sanitize(n,this._ctxName);n=i.expression,i.isHTML==!0&&(s="innerHTML"),this.inflateSrc.push([`${this.path}.${s} = \``+n+"`"].join(" "))}this.deflateSrc.push(`${this.path}.${s} = "";`)}async _processAttributes(e){let t=Array.from(e.attributes).filter(s=>s.value.indexOf("${")!=-1||s.value.indexOf("&{")!=-1||s.name.indexOf(".if")!=-1||s.name.indexOf(".attr")!=-1||s.name.indexOf("style.")!=-1||s.name.indexOf("classlist."!=-1));for(let s of t)s.name.indexOf(".attr")!=-1?this._processAttr(s):s.value.indexOf("${")!=-1?this._processAttrValue(s):s.value.indexOf("&{")!=-1?await this._processTranslationValue(s):this._processAttrCondition(s)}_clearAttributes(e){this.inflateSrc.push(`while(${this.path}.attributes.length > 0) { ${this.path}.removeAttribute(${this.path}.attributes[0].name) };`);let t=e.getAttribute("class");this.inflateSrc.push(`${this.path}.setAttribute("class", "${t}");`)}_processAttr(e){let t=e.name.replace(".attr",""),s=crsbinding.expression.sanitize(e.value,this._ctxName).expression;this.inflateSrc.push(`${this.path}.setAttribute("${t}", ${s})`)}_processAttrValue(e){let t=e.value.trim(),s=t.substr(2,t.length-3);if(s=crsbinding.expression.sanitize(s,this._ctxName).expression,e.name=="xlink:href")this.inflateSrc.push(`${this.path}.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", ${s});`);else{let n=s.split("?");this.inflateSrc.push(`if (${n[0].trim()} != null) {${this.path}.setAttribute("${e.name}", ${s});}`)}this.deflateSrc.push(`${this.path}.removeAttribute("${e.name}");`),e.ownerElement.removeAttribute(e.name)}async _processTranslationValue(e){let t=e.value.replace("&{","").replace("}",""),s=await crsbinding.translations.get(t);s==null?this.inflateSrc.push(`crsbinding.translations.get("${t}").then(result => ${this.path}.setAttribute("${e.name}", result);`):this.inflateSrc.push(`${this.path}.setAttribute("${e.name}", "${s}");`)}_processAttrCondition(e){if(e.name.trim().indexOf("style.")==0)return this._processStyle(e);if(e.name.trim().indexOf("classlist")==0)return this._processClassList(e);if(e.name.trim().indexOf(".if")!=-1)return this._processConditional(e)}_processStyle(e){let t=e.name.split("."),s=crsbinding.utils.capitalizePropertyPath(t[1]),n=crsbinding.expression.sanitize(e.value.trim(),this._ctxName).expression;this.inflateSrc.push(`${this.path}.style.${s} = ${n};`),this.deflateSrc.push(`${this.path}.style.${s} = "";`),e.ownerElement.removeAttribute(e.name)}_processClassList(e){let t=e.value.split("?"),s=crsbinding.expression.sanitize(t[0],this._ctxName).expression,n=t[1].split(":"),i=n[0].trim(),l=n.length>1?n[1].trim():"",a=i.indexOf("[")==-1?i:`...${i}`,o=`if (${s}) {${this.path}.classList.add(${a});}`;if(l.length>0){let h=l.indexOf("[")==-1?l:`...${l}`;o+=`else {${this.path}.classList.add(${h});}`}let c=`while (${this.path}.classList.length > 0) {${this.path}.classList.remove(${this.path}.classList.item(0));}`;this.inflateSrc.push(o),this.deflateSrc.push(c),e.ownerElement.removeAttribute(e.name)}_processConditional(e){let t=e.name.split(".if")[0].trim(),s=e.value.split("?"),i=[`if(${crsbinding.expression.sanitize(s[0].trim(),this._ctxName).expression})`],l=s.length>1?s[1].trim():`"${t}"`;if(l.indexOf(":")==-1)i.push("{"),i.push(`${this.path}.setAttribute("${t}", ${l});`),i.push("}"),i.push(`else {${this.path}.removeAttribute("${t}")}`);else{let a=s[1].split(":");i.push("{"),i.push(`${this.path}.setAttribute("${t}", ${a[0].trim()});`),i.push("}"),i.push(`else {${this.path}.setAttribute("${t}", ${a[1].trim()})}`)}this.inflateSrc.push(i.join("")),this.deflateSrc.push(`${this.path}.removeAttribute("${t}")`),e.ownerElement.removeAttribute(e.name)}};function Ke(r){return r==null?r:We(Object.assign({},r))}function We(r){let e=Object.getOwnPropertyNames(r).filter(t=>t.indexOf("__")==0);for(let t of e)delete r[t];e=Object.getOwnPropertyNames(r).filter(t=>t.indexOf("__")==-1&&typeof r[t]=="object");for(let t of e)We(r[t]);return r}function _(r,e){let t=r;if(e.indexOf(".")==-1)return t[e];let s=e.split(".");for(let n=0;n<s.length-1;n++){let i=s[n];if(t=t[i],t==null)return null}return t[s[s.length-1]]}function _e(r,e,t){return r==null?null:(r.__id=e,r.__property=t,new Proxy(r,{get:Nt}))}var St=["pop","splice"],kt=["push"];function Nt(r,e){let t=r[e];return typeof t=="function"?(...s)=>{let n=r[e](...s);return St.indexOf(e)!=-1?(Lt(r,n),e=="splice"&&s.length>2&&(s=s.splice(2,s.length),Ye(r,s))):kt.indexOf(e)!=-1&&Ye(r,s),n}:t}function Lt(r,e){let t=r.__id,s=r.__property;crsbinding.data.arrayItemsRemoved(t,s,e,r)}function Ye(r,e){let t=r.__id,s=r.__property;crsbinding.data.arrayItemsAdded(t,s,e,r)}var Q=class{constructor(){this._data={},this._converters={},this._callbacks={},this._updates={},this._triggers=new Map,this._context={},this._sync={},this._frozenObjects=[],this._idStore={nextId:0,nextTriggerId:0,nextArrayId:0,nextSyncId:0}}getConverter(e,t){let s=this._converters[e];if(s==null)return null;let n=_(s,t);return n==null?null:crsbinding.valueConvertersManager.get(n)}_getContextId(e){return typeof e=="object"?e.__uid||e._dataId:e}getContext(e){return this._context[e]}getData(e){return this._data[e]}array(e,t){e=this._getContextId(e);let s=this.getValue(e,t);return _e(s,e,t)}setName(e,t){this._data[e].name=t}addObject(e,t={}){let s=this._getNextId();return t.contextId=s,this._data[s]={name:e,type:"data",data:t},this._callbacks[s]={},s}removeObject(e){delete this._context[e];let t=this._removeData(e);return this._removeCallbacks(e),this._removeUpdates(e),this._removeTriggers(e),this._removeSync(e),this._removeConverters(e),t}getValue(e,t,s=!0){if(e=="undefined"||e==null)return;e=this._getContextId(e),t!=null&&t.indexOf("$globals.")!==-1&&(e=crsbinding.$globals,t=t.replace("$globals.",""));let n=this._data[Number(e)],i;if(n.type=="data"){let l=n.data;if(t==null)return l;i=t.indexOf(".")===-1?l[t]:_(l,t)}else{let l=n.refId;i=this._getReferenceValue(l,t,n.path,n.aId)}if(s==!0){let l=this.getConverter(e,t);l!=null&&(i=l.get(i))}return i}makeShared(e,t,s){e=this._getContextId(e);let n=this._callbacks[e];for(let i of s){let l=`${t}.${i}`;this._ensurePath(n,l,(a,o)=>{a[o]==null&&(a[o]={});let c=this._getNextTriggerId();this._triggers.set(c,{values:[{id:e,path:l}]}),a[o].__trigger=c})}}getProperty(e,t,s=!0){e=this._getContextId(e);let n=this.getValue(e,t,s);return Array.isArray(n)&&(n=_e(n,e,t)),n}setProperty(e,t,s,n=!0){e=this._getContextId(e);let i=this.getProperty(e,t,!1);Array.isArray(i)&&(this.array(e,t).splice(0,i.length),s!=null&&(i.__syncId!=null?s.__syncId=i.__syncId:delete s.__syncId)),s&&s.__uid!=null&&i&&this._unlinkArrayItem(i),this._setContextProperty(e,t,s,{oldValue:i,convert:n}),s&&s.__uid&&this.linkToArrayItem(e,t,s.__uid)}_setContextProperty(e,t,s,n){let i=n.oldValue,l=n.ctxName,a=n.dataType,o=n.convert||!0;e=this._getContextId(e);let c=this._data[e];if(!(c==null||c.__frozen==!0)){if(o==!0){let h=this.getConverter(e,t);h!=null&&(s=h.set(s))}a==="boolean"||typeof s=="boolean"?s=Boolean(s):(a==="number"||a==null&&typeof s!="object"&&isNaN(s)==!1&&s!="")&&(s=Number(s)),c.type=="data"?(c=this._data[e].data,(t.indexOf(".")===-1?this._setObjectProperty(c,t,s):this._setObjectPropertyPath(c,t,s))==!0&&(this._performUpdates(e,t,s,i),this.updateUI(e,t))):this._setReferenceValue(e,t,s,c.refId,c.path,c.aId,l)}}_setReferenceValue(e,t,s,n,i,l,a){let o=this._data[n];if(o.type=="data"){let c=_(o.data,i),h=c.__syncId;l!=null&&(c=c.find(p=>p.__aId==l)),a!="context"&&(t=t.split(`${a}.`).join("")),this._setObjectPropertyPath(c,t,s),h!=null&&this._frozenObjects.indexOf(c)===-1&&this._setSyncValues(h,t,s,c),this._callFunctionsOnPath(e,t)}else{let c=`${o.path}.${path}`;return this._getReferenceValue(o.refId,t,c)}}createReferenceTo(e,t,s,n){let i=this._getNextId(),l={id:i,name:t,type:"ref",refId:e,path:s};return n!==void 0&&(l.aId=n),this._data[i]=l,this._callbacks[i]={},i}_getReferenceValue(e,t,s,n){let i=this._data[e];if(i.type=="data")if(n===void 0){let l=t==null?s:`${s}.${t}`;return this.getValue(e,l)}else{let l=this.getValue(e,s),a;if(Array.isArray(l))a=l.find(o=>o.__aId==n);else{let o=l.get(n);a={key:n,value:o}}return t==null||a==null?a:_(a,t)}else{let l=`${i.path}.${s}`;return this._getReferenceValue(i.refId,t,l)}}_getNextId(){return this._nextId("nextId")}_getNextTriggerId(){return this._nextId("nextTriggerId")}nextArrayId(){return this._nextId("nextArrayId")}_nextId(e){let t=this._idStore[e];return this._idStore[e]+=1,t}createArraySync(e,t,s,n){let i=this.getValue(e,t),l=this._idStore.nextSyncId;this._idStore.nextSyncId+=1;let a={primaryKey:s,fields:n,collection:[]};return this._sync[l]=a,this.addArraySync(l,e,t,i)}removeArraySync(e,t,s){let n=this._sync[e];if(t=this._getContextId(t),n!=null){n.collection.filter(a=>a.id==t&&a.path==s).forEach(a=>n.collection.splice(n.collection.indexOf(a),1)),n.collection.length==0&&delete this._sync[e];let l=this.getValue(t,s);l!=null&&(delete l.__syncId,l.filter(a=>a.__syncId==e).forEach(a=>delete a.__syncId))}}addArraySync(e,t,s,n){return new Promise(i=>{t=this._getContextId(t),this._ensurePath(t,s,()=>{let l=this._sync[e];if(l.collection.filter(a=>a.id==t&&a.path==s).length>0)return i(e);l.collection.push({id:t,path:s}),n==null&&(n=this.getValue(t,s)),n.__syncId=e,i(e)})})}_setSyncValues(e,t,s,n){this._frozenObjects.push(n);let i=this._sync[e];if(i.fields.indexOf(t)!==-1){let l=n[i.primaryKey];for(let a of i.collection){let c=this.getValue(a.id,a.path).find(h=>h[i.primaryKey]==l);this._frozenObjects.push(c),c!=n&&this.setProperty(c,t,s)}}this._frozenObjects.length=0}addContext(e,t){this._context[e]=t}addCallback(e,t,s){let n=this._callbacks[e];return t.indexOf(".")===-1?this._addCallbackToObject(n,t,s):this._addCallbackToObjectOnPath(n,t,s)}_addCallbackToObject(e,t,s){e[t]=e[t]||{},e[t].__functions=e[t].__functions||[],e[t].__functions.push(s)}_addCallbackToObjectOnPath(e,t,s){this._ensurePath(e,t,(n,i)=>{this._addCallbackToObject(n,i,s)})}_ensurePath(e,t,s){let n=e,i=t.split(".");for(let l=0;l<i.length-1;l++){let a=i[l];n[a]==null&&(n[a]={}),n=n[a]}s&&s(n,i[i.length-1])}removeCallback(e,t,s){let n=this._callbacks[e];if(n==null)return;let i=_(n,t);if(i.__functions){let l=i.__functions.indexOf(s);l!==-1&&(i.__functions.splice(l,1),i.__functions.length==0&&delete i.__functions)}}async updateUI(e,t){e=this._getContextId(e);let s=this._callbacks[e];if(t==null){let n=this._getOwnProperties(s);for(let i of n)await this._callFunctionsOnObject(s[i],e,i)}else{if(t.indexOf(".")!==-1)return this._callFunctionsOnPath(e,t);if(s==null||s[t]==null)return;await this._callFunctionsOnObject(s[t],e,t)}}async _callFunctionsOnObject(e,t,s){if(e.__functions!=null)for(let l of e.__functions){let a=this.getValue(t,s);await l(s,a)}if(e.__trigger!=null){let l=this._triggers.get(e.__trigger);if(l.frozen!=!0){l.frozen=!0;for(let a of l.values)a.id==t&&a.path==s||await this.updateUI(a.id,a.path);delete l.frozen}}let i=this._getOwnProperties(e);for(let l of i)await this._callFunctionsOnObject(e[l],t,`${s}.${l}`)}async _callFunctionsOnPath(e,t){let s=this._callbacks[e],n=_(s,t);n!=null&&await this._callFunctionsOnObject(n,e,t)}async _performUpdates(e,t,s,n){this._performUpdatesChanges(e,t,s);let i=this._context[e];if(i==null)return;let l=`${t}Changed`;i[l]?await i[l](s,n):i.propertyChanged&&await i.propertyChanged(t,s,n)}_performUpdatesChanges(e,t,s){let n=this._updates[e];n==null||n[t]==null||this.setProperty(n[t].originId,n[t].originProperty,s)}link(e,t,s,n,i){typeof i!="object"||i===null?(this._addUpdateOrigin(e,t,s,n),this._addUpdateOrigin(s,n,e,t),this._syncValueTrigger(e,t,s,n)):this._syncTriggers(e,t,s,n)}linkToArrayItem(e,t,s){let n=_(this._callbacks[e],t);if(n==null)return;let i=this._callbacks[s],l=this._getOwnProperties(n);for(let a of l)this._copyTriggers(n,a,i,a,s,a)}_addUpdateOrigin(e,t,s,n){let i=this._updates[s]||{},l=i[n]||{};l.originId==e&&l.originProperty==t||(l.originId=e,l.originProperty=t,i[n]=l,this._updates[s]=i)}_unlinkArrayItem(e){let t=this._callbacks[e.__uid];this._removeTriggersOnCallbacks(t,e.__uid)}setArrayEvents(e,t,s,n){let i=this._callbacks[e];this._ensurePath(i,t,(l,a)=>{l[a]=l[a]||{},l[a].__itemsAdded=l[a].itemsAdded||[],l[a].__itemsAdded.push(s),l[a].__itemsDeleted=l[a].itemsDeleted||[],l[a].__itemsDeleted.push(n)})}arrayItemsAdded(e,t,s,n){let i=this._callbacks[e],l=_(i,t);if(l!=null)for(let a of l.__itemsAdded||[])a(s,n)}arrayItemsRemoved(e,t,s,n){let i=this._callbacks[e],l=_(i,t);if(l!=null)for(let a of l.__itemsDeleted||[])a(s,n)}_copyTriggers(e,t,s,n,i,l){let a=e[t],o=s[n]=s[n]||{};a.__trigger!=null&&(o.__trigger=a.__trigger,this._triggers.get(a.__trigger).values.push({id:i,path:l}));let c=this._getOwnProperties(a);for(let h of c)this._copyTriggers(a,h,o,h,i,`${l}.${h}`)}_removeData(e){let t=this._removeReferences(e);return delete this._data[e],Object.keys(this._data).length==0&&(this._idStore.nextId=1,this._idStore.nextArrayId=0),t.push(e),t}_removeReferences(e){let t=[],s=Object.keys(this._data);for(let n of s){let i=this._data[n];i.refId==e&&(t.push(i.id),this.removeObject(i.id))}return t}_removeCallbacks(e){delete this._callbacks[e]}_removeUpdates(e){let t=Array.from(this._updates).filter(s=>s[0]==e||s[1].value&&s[1].value.originId==e);for(let s of t)delete this._updates[s[0]]}_removeTriggers(e){let t=Array.from(this._triggers);for(let s of t){let n=s[1].values.findIndex(i=>i.id==e);n!=-1&&(s[1].values.splice(n,1),s.values.length==0&&this._triggers.delete(s[0]))}this._triggers.size==0&&(this._idStore.nextTriggerId=0)}_removeSync(e){let t=Object.keys(this._sync);for(let s of t){let n=this._sync[s];n.collection.filter(l=>l.id==e).forEach(l=>n.collection.splice(n.collection.indexOf(l),1)),n.collection.length==0&&delete this._sync[s]}}_removeConverters(e){delete this._converters[e]}_setObjectProperty(e,t,s){return e[t]!==s?(e[t]=s,!0):!1}_setObjectPropertyPath(e,t,s){let n=!0;return this._ensurePath(e,t,(i,l)=>n=this._setObjectProperty(i,l,s)),n}_getOwnProperties(e){return Object.getOwnPropertyNames(e).filter(t=>t.indexOf("__")===-1)}_removeTriggersOnCallbacks(e,t){let s=this._getOwnProperties(e);for(let n of s){let i=e[n].__trigger;i!=null&&(delete e[n].__trigger,this._removeTriggersOnTriggers(t,i)),typeof e[n]=="object"&&this._removeTriggersOnCallbacks(e[n])}}_removeTriggersOnTriggers(e,t){let s=this._triggers.get(t),n=s.values.filter(i=>i.id==e);for(let i of n){let l=s.values.indexOf(i);s.values.splice(l,1)}}_syncValueTrigger(e,t,s,n){let i=this._callbacks[e],l=this._callbacks[s],a=_(i,`${t}.__trigger`);a!=null&&(l[n]=l[n]||{},l[n].__trigger=a,this._triggers.get(a).values.push({id:s,path:n}))}_syncTriggers(e,t,s,n){let i=this._callbacks[e],l=this._callbacks[s];t.indexOf(".")===-1?this._copyTriggers(i,t,l,n,s,n):this._ensurePath(l,n,(a,o)=>{a[o]=a[o]||{};let c=t.split("."),h=c[c.length-1],p=c.splice(0,c.length-1).join(),le=_(i,p);this._copyTriggers(le,h,a,o,s,n)})}setPropertyConverter(e,t,s,n){if(s!=null){e=this._getContextId(e);let i=this._converters[e];i==null&&(i={},this._converters[e]=i),this._ensurePath(i,t,(l,a)=>{l[a]=s})}n!=null&&this.setPropertyConverterTriggers(e,t,n)}setPropertyConverterTriggers(e,t,s){e=this._getContextId(e);let n=[];for(let l of s){let a=l.split(":"),o=a[0],c=a[1];this.setPropertyConverter(e,o,c),n.push(`crsbinding.data.setProperty(${e}, "${o}", value);`)}let i=new Function("property","value",n.join(`
`));this.addCallback(e,t,i)}};var X=class{constructor(){this._events=new Map}dispose(){this._events.clear()}async on(e,t){let s=[];this._events.has(e)?s=this._events.get(e):this._events.set(e,s),s.indexOf(t)==-1&&s.push(t)}async emit(e,t){if(this._events.has(e)){let s=this._events.get(e);if(s.length==1)return await s[0](t);for(let n of s)await n(t)}}async remove(e,t){if(this._events.has(e)){let s=this._events.get(e),n=s.indexOf(t);n!=-1&&s.splice(n,1),s.length===0&&this._events.delete(e)}}async postMessage(e,t,s){let n=s||document,i=Array.from(n.querySelectorAll(e)),l=[];for(let a of i)l.push(a.onMessage.call(a,t));await Promise.all(l)}};var Z=class extends HTMLElement{get hasOwnContext(){return!0}constructor(){super(),this.hasOwnContext==!0&&(this._dataId=crsbinding.data.addObject(this.constructor.name),crsbinding.data.addContext(this._dataId,this)),crsbinding.dom.enableEvents(this),this.__properties=new Map}dispose(){this._disposing=!0,crsbinding.utils.forceClean(this),crsbinding.dom.disableEvents(this);let e=Object.getOwnPropertyNames(this);for(let t of e)delete this[t]}async connectedCallback(){if(!(this._dataId==null||this.__isLoading==!0)){if(this.__isLoading=!0,this.preLoad!=null){let e=(t,s)=>{crsbinding.data.setProperty(this._dataId,t,s)};await this.preLoad(e)}if(this.html!=null){this.innerHTML=await crsbinding.templates.get(this.constructor.name,this.html);let e=crsbinding.utils.getPathOfFile(this.html);await crsbinding.parsers.parseElements(this.children,this._dataId,e?{folder:e}:null)}requestAnimationFrame(()=>{let e=this.getAttribute("name");e!=null&&crsbinding.data.setName(this._dataId,e)}),this.__properties.forEach((e,t)=>crsbinding.data.setProperty(this._dataId,t,e)),this.__properties.clear(),delete this.__properties,this.load!=null&&this.load(),this.isReady=!0,this.dispatchEvent(new CustomEvent("ready")),delete this.__isLoading}}async disconnectedCallback(){this.dispose(),crsbinding.utils.disposeProperties(this),crsbinding.observation.releaseBinding(this)}getProperty(e){return crsbinding.data.getProperty(this,e)}setProperty(e,t,s=!1){if(this.isReady!=!0&&s===!1&&this.__properties)return this.__properties.set(e,t);crsbinding.data.setProperty(this,e,t)}};var w=class extends HTMLElement{get hasOwnContext(){return!0}get ctx(){return this._dataId}set ctx(e){if(this._dataId=e,e!=null){let t=this.getAttribute("name");t!=null&&crsbinding.data.setName(this._dataId,t),this._loadView()}}get view(){return this._view}set view(e){this._view!=e&&(this._view=e,this._loadView())}constructor(){super();let e=this.getAttribute("ctx.one-way")||this.getAttribute("ctx.once");this.hasOwnContext==!0&&e==null&&(this._dataId=crsbinding.data.addObject(this.constructor.name),crsbinding.data.addContext(this._dataId,this)),crsbinding.dom.enableEvents(this)}dispose(){this._disposing=!0,crsbinding.utils.forceClean(this),crsbinding.dom.disableEvents(this),crsbinding.templates.unload(this.store)}async connectedCallback(){await this._initialize()}async _initialize(){this.__isLoading=!0,this.store=this.dataset.store||this.constructor.name,await crsbinding.templates.loadFromElement(this.store,this,this.html,async e=>{this.preLoad!=null&&await this.preLoad(),this.load!=null&&this.load(),this.__isLoading=!1,this.view=e.name})}async disconnectedCallback(){this.dispose(),crsbinding.utils.disposeProperties(this),crsbinding.observation.releaseBinding(this)}getProperty(e){return crsbinding.data.getProperty(this,e)}setProperty(e,t,s=!1){if(this.isReady!=!0&&s===!1&&this.__properties)return this.__properties.set(e,t);crsbinding.data.setProperty(this,e,t)}async _loadView(){if(this.__isLoading==!0||this._view==null||this._dataId==null)return;crsbinding.observation.releaseChildBinding(this),this.innerHTML="";let e=await crsbinding.templates.getById(this.store,this._view);this.appendChild(e),await crsbinding.parsers.parseElements(this.children,this._dataId,{folder:this.dataset.folder}),requestAnimationFrame(()=>{this.dataset.view=this._view,this.dispatchEvent(new CustomEvent("view-loaded"))})}};customElements.define("perspective-element",w);var ee=class{get title(){return this.getProperty("title")}set title(e){this.setProperty("title",e)}get element(){return this._element}set element(e){this._element=e}constructor(e){this._dataId=crsbinding.data.addObject(this.constructor.name),crsbinding.data.addContext(this._dataId,this),this.element=e}async connectedCallback(){if(this.preLoad!=null){let t=(s,n)=>{crsbinding.data.setProperty(this._dataId,s,n)};await this.preLoad(t)}let e=crsbinding.utils.getPathOfFile(this.html);await crsbinding.parsers.parseElement(this.element,this._dataId,e?{folder:e}:null),this.load()}async disconnectedCallback(){crsbinding.utils.forceClean(this._dataId),crsbinding.observation.releaseBinding(this.element),crsbinding.utils.disposeProperties(this),this.element=null}getProperty(e,t=!0){return crsbinding.data.getProperty(this,e,t)}setProperty(e,t,s=!0){crsbinding.data.setProperty(this,e,t,s)}load(){this._element.style.visibility="",this._loaded=!0}};var A=class extends HTMLElement{disconnectedCallback(){this._clearElements(),delete this._dataId}async onMessage(e){this._clearElements();let t=e.context;if(t&&typeof t=="object"&&(t=t.__uid||t._dataId),this._dataId=t,this.innerHTML=e.html,this._dataId!=null){let s=crsbinding.data._context[this._dataId];await crsbinding.parsers.parseElements(this.children,this._dataId,{folder:s.html})}}_clearElements(){for(let e of this.children)crsbinding.observation.releaseBinding(e)}};customElements.define("crs-widget",A);var te=class{constructor(){this._items=new Map}dispose(){this._items.clear(),this._items=null}register(e,t,s=!1){let n=crsbinding.utils.cloneTemplate(t),i={elements:[n],template:t};s===!0&&crsbinding.utils.measureElement(n).then(l=>i.size=l),this._items.set(e,i)}getItemElement(e){return e.elements.pop()||crsbinding.utils.cloneTemplate(e.template)}getElement(e){let t=this._items.get(e);return this.getItemElement(t)}getElements(e,t){let s=this._items.get(e),n=document.createDocumentFragment();for(;n.children.length<t;)n.appendChild(this.getItemElement(s));return n}async getBoundElement(e,t){let s=this._items.get(e),n=this.getItemElement(s);return await crsbinding.parsers.parseElement(n,t),n}returnElements(e,t){let s=this._items.get(e);for(let n of t)s.elements.push(n)}unregister(e){let t=this._items.get(e);t!=null&&(this._items.delete(e),t.elements.length=0,t.template=null)}};var se=class{constructor(){this._converters=new Map}add(e,t){this._converters.set(e,t)}get(e){return this._converters.get(e)}remove(e){this._converters.delete(e)}convert(e,t,s){let n=this._converters.get(t);return n==null?null:n[s](e)}};function Ge(r){if(typeof r=="object"&&(r=r.__uid||r._dataId),r==null)return;let e=crsbinding.data.removeObject(r),t=new Set;for(let s of e){let n=Array.from(crsbinding.providerManager.items).filter(i=>i[1]._context===s);for(let i of n)t.add(i[1]._element)}for(let s of t)crsbinding.providerManager.releaseElement(s);t.length=0}function Je(r,e,t=null,s=null){let n="render-collection";crsbinding.inflationManager.register(n,r);let i=crsbinding.inflationManager.get(n,e,t,0);i!=null&&s!=null&&s.appendChild(i),crsbinding.inflationManager.unregister(n)}var ne=class{constructor(){this._tagMap=new Map,this._queue=[],this._observed=new Map}dispose(){this._tagMap.clear(),this._tagMap=null}define(e,t){this._tagMap.has(e)==!1&&this._tagMap.set(e,t),this._processElements(e)}parse(e){let t=e.querySelectorAll("[is]");if(t.length!=0){this._observe(e);for(let s of t){let n=s.getAttribute("is");this._tagMap.has(n)==!1?this._queue.push({parent:e,cName:n,el:s}):this._createComponent({parent:e,cName:n,el:s})}}}removeComponent(e){let t=null,s=e,n=0;for(;t==null||n==100;){if(n++,s.nodeName.toLocaleString()=="svg"){t=s;break}s=s.parentElement}this._removeComponentFromSvg(t,e)}_removeComponentFromSvg(e,t){let s=this._observed.get(e);if(s==null)return;let n=s.children.get(t);n!=null&&(n.disconnectedCallback(),n.dispose(),s.children.delete(t),t.parentElement.removeChild(t),n=null,t=null)}release(e){if(this._observed.size==0)return;let t=e.querySelectorAll("[is]");for(let n of t)this._removeComponentFromSvg(e,n);let s=this._observed.get(e);s.children.clear(),s.children=null,this._observed.delete(e)}_observe(e){if(this._observed.has(e))return;let t={children:new Map};this._observed.set(e,t)}_createComponent(e){let t=this._tagMap.get(e.cName),s=this._observed.get(e.parent);if(s.children.has(e.el)==!1){let n=new t(e.el);s.children.set(e.el,n),n.connectedCallback()}delete e.parent,delete e.cName,delete e.el}_processElements(e){let t=this._queue.filter(s=>s.cName==e);for(let s of t)this._createComponent(s),this._queue.splice(this._queue.indexOf(s),1)}};var ie=class{constructor(e){this.element=e}dispose(){this.element=null}async connectedCallback(){}async suspend(){}async restore(){}};function Qe(r,e){crsbinding.templates.data[r]=e}function Xe(r){let e=Array.isArray(r)==!0?r:[r];for(let t of e)crsbinding.templates.data[t]?.count!=null?(crsbinding.templates.data[t].count-=1,crsbinding.templates.data[t].count==0&&(delete crsbinding.templates.data[t].templates,delete crsbinding.templates.data[t].style,delete crsbinding.templates.data[t])):delete crsbinding.templates.data[t]}function Ze(){let r=Object.keys(crsbinding.templates.data);for(let e of r)delete crsbinding.templates.data[e]}async function et(r,e){let t=crsbinding.templates.data[r];return t==null&&(t=await fe(r,e)),t.cloneNode(!0).innerHTML}async function fe(r,e){let t=crsbinding.templates.data[r];return t!=null||(t=document.createElement("template"),t.innerHTML=await fetch(e).then(s=>s.text()),crsbinding.templates.data[r]=t),t}async function tt(r,e,t,s){if(crsbinding.templates.data[r]!=null){crsbinding.templates.data[r].count+=1,crsbinding.templates.data[r].callbacks.push(s);return}let n={count:1,templates:{},callbacks:[s]};crsbinding.templates.data[r]=n;let i,l;if(t!=null){let o=document.createElement("template");o.innerHTML=await fetch(t).then(c=>c.text()),i=o.content.querySelectorAll("template"),l=o.content.querySelector("style")}else i=e.querySelectorAll("template"),l=e.querySelector("style");n.style=l;let a;for(let o of i)n.templates[o.dataset.id]=o,o.parentElement?.removeChild(o),o.dataset.default=="true"&&(a=o);for(let o of n.callbacks){let c=Ht(a);l!=null&&c.insertBefore(l,c.firstChild),o(c)}n.callbacks.length=0,delete n.callbacks}function Ht(r){let e=r.content.cloneNode(!0);return e.name=r.dataset.id,e}async function st(r,e){let t=crsbinding.templates.data[r],n=t.templates[e].content.cloneNode(!0);return t.style!=null&&n.insertBefore(t.style,n.firstChild),n}var re=class{constructor(){this.dictionary={}}dispose(){this.dictionary=null}async add(e,t){E(t||"",e,this.dictionary)}async delete(e){let t=`${e}.`,s=Object.keys(this.dictionary).filter(n=>n.indexOf(t)===0);for(let n of s)delete this.dictionary[n]}async parseElement(e){e.children.length==0&&e.textContent.indexOf("&{")!=-1&&(e.textContent=await this.get_with_markup(e.textContent.trim()));for(let t of e.attributes)await this.parseAttribute(t);for(let t of e.children)await this.parseElement(t)}async parseAttribute(e){e.nodeValue.indexOf("&{")!==-1&&(e.nodeValue=await this.get_with_markup(e.nodeValue))}async get(e){let t=this.dictionary[e];return t!=null||(t=this.fetch==null?null:await this.fetch(e),t!=null&&(this.dictionary[e]=t)),t}async get_with_markup(e){return e=e.split("&{").join("").split("}").join(""),await this.get(e)}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};function Mt(r){let e=r.split("-");for(let s=1;s<e.length;s++)e[s]=e[s].capitalize();let t=e.join("");return t==="innerHtml"&&(t="innerHTML"),t}var x={_expFn:new Map,data:new Q,idleTaskManager:new G,providerManager:new Y,inflationManager:new J,elementStoreManager:new te,svgCustomElements:new ne,valueConvertersManager:new se,translations:new re,expression:{sanitize:ye,compile:me,release:ge},observation:{releaseBinding:ue,releaseChildBinding:ze},parsers:{parseElement:Fe,parseElements:q},classes:{BindableElement:Z,PerspectiveElement:w,ViewBase:ee,RepeatBaseProvider:m,Widget:A,SvgElement:ie},events:{listenOnPath:Re,removeOnPath:Be,emitter:new X},dom:{enableEvents:qe,disableEvents:Ue},utils:{capitalizePropertyPath:Mt,clone:Ke,disposeProperties:oe,fragmentToText:je,cloneTemplate:Te,measureElement:Ie,forceClean:Ge,renderCollection:Je,relativePathFrom:Se,getPathOfFile:ce,getValueOnPath:_,flattenPropertyPath:E},templates:{data:{},load:fe,add:Qe,get:et,unload:Xe,unloadAll:Ze,loadFromElement:tt,getById:st}};globalThis.crsbinding=x;x.$globals=x.data.addObject("globals");x.data.globals=x.data.getValue(x.$globals);globalThis.crsb=x;
